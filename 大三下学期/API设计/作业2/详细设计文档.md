根据需求文档进行系统方案设计，形成系统详细设计文档，需写明对外交互的api
# 数据库设计
![[Pasted image 20240414113817.png]]
数据库使用sqlite,主要有用户表和salary表
# 系统架构图
本系统前端是微信小程序,后端采用golang+sqlite,使用统一接口接收前端请求后转发到其他接口,由其它接口处理完毕后返回.
系统通过校验验证发送的请求是否是来自微信官方的，并且限制内部api接口只能由本地ip(127.0.0.1)访问。
![[Pasted image 20240408182625.png]]
验证信息是否从微信服务器发送
![[Pasted image 20240408182652.png]]
![[未命名文件.png]]
# 接口大全
## 微信接口
| Method | URL       | 用途                                |
| :----- | --------- | :-------------------------------- |
| GET    | /api/ping | 用于微信的服务器寻找                        |
| POST   | /api/ping | 用于接收微信用户的信息并且转发给内部接口然后给微信用户返回请求结果 |
## 内部接口
### 用户接口

| Mehod | URL       | 用途        | 前端发送信息格式                       |
| :---- | :-------- | :-------- | :----------------------------- |
| GET   | /api/user | 获取自己的用户信息 | {"method":"GET","url":"/user"} |

返回格式:
```json
{
    "data": {
        "salaries": null,
        "signature": "我很帅我知道",
        "user_id": "obGiG6n3SPlTapeLcCVx2VAg1la8",
        "username": "热心用户"
    }
}
```


| Mehod | URL       | 用途      | 前端发送信息格式                                                                                                                                    |
| :---- | :-------- | :------ | :------------------------------------------------------------------------------------------------------------------------------------------ |
| PUT   | /api/user | 修改自己的信息 | {<br>    "method":"PUT",<br>    "url":"/user",<br>    "json_data":{<br>        "username":"许一涵",<br>        "signature":"我很帅"<br>    }<br>} |
返回格式
```json
{
    "data": {
        "msg": "success"
    }
}
```
### 薪资接口
| Mehod | URL                                         | 用途   | 前端发送信息格式                                                              |
| :---- | :------------------------------------------ | :--- | :-------------------------------------------------------------------- |
| GET   | /salary?page_size=?&page=?&city=?&company=? | 查询薪资 | {"method":"GET","url":"/salary?page_size=5&page=1&company=狐&city=北京"} |
|       |                                             |      |                                                                       |
返回格式
```json
{
    "data": [
        {
            "category_first": "设计/交互",
            "category_second": "游戏设计",
            "city": "北京",
            "company": "搜狐畅游",
            "id": 11,
            "major": "不限",
            "name": "【2024届春招】2D角色设计师",
            "salary": "12-15k"
        },
        {
            "category_first": "产品",
            "category_second": "游戏策划",
            "city": "北京",
            "company": "搜狐畅游",
            "id": 13,
            "major": "不限",
            "name": "【2024届春招】游戏剧情策划",
            "salary": "12-18k"
        },
        {
            "category_first": "技术/开发",
            "category_second": "后端开发",
            "city": "北京",
            "company": "搜狐畅游",
            "id": 22,
            "major": "不限",
            "name": "【2025届实习】Java开发实习生",
            "salary": "200-240/天"
        },
        {
            "category_first": "技术/开发",
            "category_second": "后端开发",
            "city": "北京",
            "company": "搜狐畅游",
            "id": 33,
            "major": "不限",
            "name": "【2024届春招】U3D开发工程师",
            "salary": "16-22k"
        },
        {
            "category_first": "技术/开发",
            "category_second": "其他技术/开发职位",
            "city": "北京",
            "company": "搜狐畅游",
            "id": 40,
            "major": "不限",
            "name": "【2024届春招】技术美术",
            "salary": "18-25k"
        }
    ]
}
```

| Mehod | URL                  | 用途        | 前端发送信息格式                                      |
| :---- | :------------------- | :-------- | :-------------------------------------------- |
| GET   | /salary/getById?id=? | 查询指定id的薪资 | {"method":"GET","url":"/salary/getById?id=1"} |
返回格式
```json
{
    "data": {
        "category_first": "人事/财务/行政",
        "category_second": "人力资源",
        "city": "固安、昆山、合肥、广州",
        "company": "维信诺",
        "id": 1,
        "major": "本科/硕士研究生，人力资源、行政管理、工商管理等相关专业",
        "name": "24届-人力/行政方向",
        "salary": "7-13K"
    }
}
```

| Mehod | URL                                              | 用途          | 前端发送信息格式                                                                    |
| :---- | :----------------------------------------------- | :---------- | :-------------------------------------------------------------------------- |
| GET   | /salary/getByUserId?page_size=?&page=?&user_id=? | 查询指定用户创建的薪资 | {"method":"GET","url":"/salary/getByUserId?page_size=5&page=1&user_id=..."} |
|       |                                                  |             |                                                                             |
返回格式
```json
{
    "data": [
        {
            "category_first": "技术/开发",
            "category_second": "前端开发",
            "city": "北京",
            "company": "华为",
            "id": 401,
            "major": "软件工程",
            "name": "",
            "salary": "20w"
        }
    ]
}
```

| Mehod | URL            | 用途       |     | 前端发送信息格式                                                                                                                                                                                                                                                                    |
| :---- | :------------- | :------- | --- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| POST  | /salary/create | 创建单条薪资信息 |     | {<br>    "method":"POST",<br>    "url":"/salary/create",<br>    "json_data":{<br>        "Company":"华为",<br>        "City":"北京",<br>        "Salary":"20w",<br>        "Major":"软件工程",<br>        "CategoryFirst":"技术/开发",<br>        "CategorySecond":"前端开发"<br>    }<br>} |
返回格式
```json
{
    "data": {
        "msg": "success"
    }
}
```

| Mehod | URL             | 用途       | 前端发送信息格式                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| :---- | :-------------- | :------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| POST  | /salary/creates | 批量创建薪资信息 | <br>{<br>    "method":"POST",<br>    "url":"/salary/creates",<br>    "json_data":{<br>        "salaries":[<br>            {<br>                "Company":"字节跳动",<br>                "City":"北京",<br>                "Salary":"230w",<br>                "Major":"软件工程",<br>                "CategoryFirst":"技术/开发",<br>                "CategorySecond":"前端开发"<br>            },<br>            {<br>                "Company":"字节跳",<br>                "City":"北京",<br>                "Salary":"300w",<br>                "Major":"软件工程",<br>                "CategoryFirst":"技术/开发",<br>                "CategorySecond":"前端开发"<br>            },<br>            {<br>                "Company":"字节跳",<br>                "City":"北京",<br>                "Salary":"20w",<br>                "Major":"软件工程",<br>                "CategoryFirst":"技术/开发",<br>                "CategorySecond":"前端开发"<br>            },<br>            {<br>                "Company":"字节跳动",<br>                "City":"北京",<br>                "Salary":"20w",<br>                "Major":"软件工程",<br>                "CategoryFirst":"技术/开发",<br>                "CategorySecond":"前端开发"<br>            }<br>        ]   <br>    }<br>}<br> |
返回格式
```json
{
    "data": {
        "msg": "success"
    }
}
```

| Mehod  | URL          | 用途              | 前端发送信息格式                                                         |
| :----- | :----------- | :-------------- | :--------------------------------------------------------------- |
| DELETE | /salary/id=? | 用户删除指定id的salary | {<br>    "method":"DELETE",<br>    "url":"/salary?id=?"<br>}<br> |
返回结果：
```json
//不是自己的薪资的时候
{
    "error": "unauthorized"
}

//是自己的薪资的时候
{
    "data": {
        "msg": "success"
    }
}
```
