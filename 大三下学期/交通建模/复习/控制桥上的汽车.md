目的是通过构造获得一个正确的系统
正确性标准被制定为证明义务`proof obligation`
证明会通过相继式进行计算(使用推理规则进行推理)
- 确定需求文档
- 指定求精策略
- 开发初始模型并求精
## 需求
有两种需求
- 与设备相关的标记为EQP(equipment)
- 与功能相关的标记为FUN(function)
## 求精策略
- 限制车的数量
- 引入单行道
- 映入红绿灯
- 加入传感器

## 第一次求精
只考虑岛上的车,两个事件,一个ML_out,一个ML_in
**静态部分**:constant(常量) 和 axiom(公理)
比如 constant d(d是道桥联合体上最多的车数量)
axm0_1 d∈N d是自然数
**动态部分**:variable n(表示道桥联合体上的车辆数目)
invariants(不变式): 
- inv0_1 n∈N
- inv0_2 n≤d
0表示是初始模型 1表示公理1
事件ML_out
```
ML_out:
	n:=n+1
	^   ^
	|   |
  发生前 发生后

ML_in:
	n:=n-1
	
```

为什么要近似?
- 有可能在后续被精化
- 在当前阶段可能不够因为不满足不变式
因此我们要验证一致性

## 不变式
不变式就是模型的所有状态必须满足这个不变式
- 模型的初始状态满足
- 所有时间也满足
我们称这俩叫证明义务(POs)
每个事件都可以被前后谓词链接(before-after predicate),发生前是n,发生后是n',比如n:=n-1,前面的n就是n'

## 相继式sequent
`n∈N |- n+1∈N`
![[Pasted image 20240616153011.png]]
一般写为H |- G,读作假设H可以推导出G.
## 不变式表示
假设有常量c,公理A(c)和变量v,不变式写作I(c,v),INV就是证明义务命名
![[Pasted image 20240616153454.png]]
INV表示不变式<font color="#2DC26B">保持证明义务</font>
![[Pasted image 20240616153612.png]]
在我们的代码中,
inv0_1: n∈N,inv0_2: n<=d, axm0_1: d∈N
=> n∈N,n<=d,d∈N|- n+1∈N    n∈N,n<=d,d∈N|- n+1<=d
我们需要对每一条不变式都进行证明,两个事件可以得到4个不变式证明义务
## 推理规则Inference Rules
![[Pasted image 20240616153950.png]]
上面的事antecedents前提,下面的是consequent结论,为了证明下面,只需要证明前提.
## Guard守卫
我们对事件添加卫,因为证明出来时间的出现需要满足一定的条件
卫是事件发生的必要条件
所以一般的不变式定义需要修改,加入卫:![[Pasted image 20240616155634.png]]
## 初始化
一个系统必须被初始化.初始化没有守卫,且右边没有谓词,
```go
init
	n:=0
```
![[Pasted image 20240616155838.png]]
我们必须证明初始化的时候的不变式也是成立的
![[Pasted image 20240616155924.png | 200]]
## 无死锁证明 DLF
![[Pasted image 20240616160043.png]]
在任何时刻,至少有一个时间成立
## 初始模型的证明义务
![[Pasted image 20240616160234.png]]
- 模型建立时候不变式证明义务
- 守卫无死锁
- 事务的不变式证明义务
## 求精
之前的叫抽象模型,求精后的叫精化模型
![[Pasted image 20240616160632.png]]
精化之后的代码需要和前面的有部分联系![[Pasted image 20240616160848.png]]
我们必须保证精化后的模型和前面的不矛盾且精化后的卫要比抽象的强
求精后还需要添加一些新事件,
## 守卫增强
![[Pasted image 20240616161038.png]]
必须由现在的可以推导出前面的卫
## 证明新事件收敛
证明新事件收敛需要两步![[Pasted image 20240616161426.png]]![[Pasted image 20240616161433.png]]
首先需要找到一个变式,比如2a+b,然后证明事件发生之后的小于事件发生之前的
比如a发生后=>a-1,b=>a+1,那么就可以证明2*(a-1)+b+1<2a+b
新事件加入后也需要证明无死锁哦
![[Pasted image 20240616162433.png]]