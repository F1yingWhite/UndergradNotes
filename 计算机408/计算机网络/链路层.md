# 链路层的服务
- 成帧：每个网络数据包经过链路传输之前，都要用链路层帧封装起来，其中网络层数据包就插在数据字段中。
- 链路接入：媒体访问控制协议（MAC）规定了帧在链路上传输的规则
- 可靠交付：保证无差错的经过链路层移动每个网络数据报，一般用于无线网络
- 差错纠正和检测：当帧的一个比特作为1传输，有可能被错认为0，所以需要差错检测
# 差错纠正和检测
## 奇偶校验
![[Pasted image 20240509153940.png]]
奇校验就是加上检验位的1的个数基数，偶校验就是1的个数偶数。我们也有二维奇偶校验![[Pasted image 20240509154910.png]]
将d比特划分为i行j列默认，然后让每一行每一列都是基数/偶数个
## 循环冗余检测
如今广泛使用循环冗余检测编码CRC，也叫多项式编码，计算的方式大概就是竖式除法，下面的有点问题，就是做异或运算
![[Pasted image 20240509191639.png]]
# 多路访问链路和协议
有三种：信道划分协议 随机接入协议 轮训协议
## 信道划分协议
有时分复用TDM和频分复用FDM
![[Pasted image 20240509192401.png]]
## 随机接入协议
每个节点以最高速度发送，当碰撞的时候停止发送
### 时隙ALOHA
所有帧都由L比特，时间被划分为L/R的时隙，节点同步且只在每个时隙的起点发送，每个时隙的每个节点的发送概率为P
- 当一个帧要发送，他需要等到下一个时隙的开始
- 如果没有碰撞则发送成功
- 如果碰撞，那么以概率p在以后的每个时隙尝试重发
假设有n个节点，那么一个节点的成功率就是$p(1-p)^{N-1}$.任意一个节点传输成功的概率为$N*p(1-p)^{N-1}$.取N到极限，概率只有大概0.37左右
### ALOHA
其实真实的世界是没有时隙的。如果一个传输的帧与一个或多个传输经历了碰撞，这 个节点将立即（在完全传输完它的碰撞帧之后）以概率p重传该帧。否则，该节点等待一 个帧传输时间。在此等待之后，它则以概率p传输该帧，或者以概率1 -p在另一个帧时 间等待（保持空闲）。
在纯aloha中，必须前后俩时间帧内不发送，所以概率是$p(1-p)^{2(N-1)}$
![[Pasted image 20240509193344.png]]
### CSMA载波监听多路访问
载波监听：说之前先看看有没有人说话
碰撞检测：如果有另一个节点干扰信号，那么就停止传输
这两个规则包含在载波监听多路访问CSMA和具有碰撞检测的CSMA(CSMA/CD)中，

## 轮流协议
### 轮训协议
要求其中是一个主节点，主节点以循环的方式轮询（poll）每个节点。例如：主节点像节点1发送一个报文，告诉他能够传输的帧的最多数量。在节点以传输某些帧后，再告诉节点而能发送的最大数量。但是主节点可能故障，或者一个节点不需要传递那么多信息
### 令牌传输协议
一个令牌的特殊帧在节点中以某种次序进行交换，当一个节点有需要发送的帧的时候他会持有令牌，然后发送最大帧再交给下一个，否则他立即传给下一个

# 链路层寻址和ARP
MAC地址也叫链路层地址、LAN地址，物理地址。最多6字节。尽管 MAC地址被设计为永久的，但用软件改变一块适配器的MAC地址现在是可能的。
<font color="#2DC26B">MAC地址广播</font>：发送48个1组成的字符串，让局域网上的所有的其他适配器接受他的帧
## 地址解析协议ARP
因为存在网络地址和链路层地址，要在他们间转换，就需要地址解析协议
每台主机/路由器有一个ARP表。包含IP地址到MAC地址的映射![[Pasted image 20240509210639.png]]
1. 主机A首先查看自己的ARP缓存表，确定其中是否包含有主机B对应的ARP表项。如果找到了对应的MAC地址，则主机A直接利用ARP表中的MAC地址，对IP数据包进行帧封装，并将数据包发送给主机B。
2. 如果主机A在ARP表中找不到对应的MAC地址，则将缓存该数据报文，然后以<font color="#2DC26B">广播方式</font>发送一个ARP请求报文。ARP请求报文中的发送端IP地址和发送端MAC地址为主机A的IP地址和MAC地址，目标IP地址和目标MAC地址为<font color="#2DC26B">主机B的IP地址和</font><font color="#2DC26B">全0的MAC地址</font>。由于ARP请求报文以广播方式发送，该网段上的所有主机都可以接收到该请求，但只有被请求的主机（即主机B）会对该请求进行处理。
3. 主机B比较自己的IP地址和ARP请求报文中的目标IP地址，当两者相同时进行如下处理：将ARP请求报文中的发送端（即主机A）的IP地址和MAC地址存入自己的ARP表中。之后以单播方式发送ARP响应报文给主机A，其中包含了自己的MAC地址。
4. 主机A收到ARP响应报文后，将主机B的MAC地址加入到自己的ARP表中以用于后续报文的转发，同时将IP数据包进行封装后发送出去。
## 多个子网的MAC交互
![[Pasted image 20240509211149.png]]
当主机111\*4要像222\*4发送报文的时候，因为找不到啊，先用广播所以就用路由的MAC地址广播找到路由器地址，然后让路由器发送
